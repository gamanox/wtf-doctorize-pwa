<template>
    <div class="page consulta-flow" id="nueva_consulta">
        <div class="header basic center fixed">
            <a class="btn_back">
                <i class="material-icons">chevron_left</i>
            </a>
            <p class="title1">Nueva Consulta</p>
            <a class="edit none">
                <i class="material-icons">more_horiz</i>
            </a>
        </div>
        <div class="page-content">
            <img src="../static/icons/logo_t.svg" alt="">
            <div class="slot datos_generales">
                <div class="title">
                    <p class="text">Datos Generales</p>
                </div>
                <div class="content">
                    <div class="item-input v2">
                        <label for="nombre">Nombre del paciente</label>
                        <div class="item-input-inner dropdown-blue">
                            <input class="notnull" list="pacientes" type="text" id="nombre"
                                placeholder="Nombre del paciente" required validate>
                        </div>
                    </div>
                    <div class="item-input v2">
                        <label for="motivo">Motivo de consulta</label>
                        <div class="item-input-inner textarea">
                            <textarea class="resizable notnull" id="motivo" placeholder="Agrege algo mas..." required
                                validate></textarea>
                        </div>
                    </div>
                    <div class="item-input v2">
                        <label for="notes">Notas</label>
                        <div class="item-input-inner textarea">
                            <textarea class="resizable" id="notes" placeholder="Agrege algo mas..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="slot archivos">
                <div class="title">
                    <p class="text">Añadir archivos</p>
                </div>
                <div class="content">
                    <div class="cards">

                    </div>
                    <div class="item-input v2 upload">
                        <label for="file">
                            <input type="file" accept=".txt,.doc,.docx,.pdf,.jpeg,.png,.jpg,.ppt,.pptx,.xls,.xlsx"
                                name="file" id="file" placeholder="Añadir archivo adjunto" required validate>
                            <i class="material-icons">add_circle</i>
                            <p>Agregar archivo</p>
                        </label>
                        <p class="notes">
                            Tamaño máximo 5MB.
                        </p>
                    </div>
                </div>
            </div>
            <div class="slot vitales">
                <div class="title">
                    <p class="text">Vitales</p>
                </div>
                <div class="content">
                    <div class="card v2 sqr" id="temperatura">
                        <div class="card-header fade-out">
                            <a class="add">
                                <i class="material-icons">add_circle</i>
                            </a>
                            <p>Temperatura</p>
                        </div>
                        <div class="card-header fade-in none">
                            <img src="../static/icons/Temperatura.svg" alt="">
                            <p class="title">Temperatura</p>
                            <p class="edit">Editar</p>
                        </div>
                        <div class="card-content fade-out">
                            <img src="../static/icons/Temperatura.svg" alt="">
                            <p>c</p>
                        </div>
                        <div class="card-content fade-in none">
                            <p>°</p>
                            <input type="number" name="temp_num" id="temp_num" class="notnull"
                                onkeypress="this.style.width = ((this.value.length + 1) * 48) + 'px';">
                            <input type="text" name="unity" class="unity"
                                onkeypress="this.style.width = ((this.value.length + 1) * 24) + 'px';">
                        </div>
                        <div class="card-footer fade-out">
                            <p class="show_num">-°</p>
                        </div>
                        <div class="card-footer fade-in none">
                            <div class="container two">
                                <div class="btn-2 woi red cancel">
                                    <a href="#" class="cancel">
                                        <p>Cancelar </p>
                                    </a>
                                </div>
                                <div class="btn-2 woi sig">
                                    <a href="#" class="sig">
                                        <p>Siguiente </p>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card v2 sqr" id="presion">
                        <div class="card-header fade-out">
                            <a class="add">
                                <i class="material-icons">add_circle</i>
                            </a>
                            <p>Presión</p>
                        </div>
                        <div class="card-header fade-in none">
                            <img src="../static/icons/Presión.svg" alt="">
                            <p class="title">Presión</p>
                            <p class="edit">Editar</p>
                        </div>
                        <div class="card-content fade-out">
                            <img src="../static/icons/Presión.svg" alt="">
                            <p>mm/Hg</p>
                        </div>
                        <div class="card-content fade-in none">
                            <p></p>
                            <input type="number" name="temp_num" id="pres_num" class="notnull"
                                onkeypress="this.style.width = ((this.value.length + 1) * 48) + 'px';">
                            <input type="text" name="unity" class="unity"
                                onkeypress="this.style.width = ((this.value.length + 1) * 24) + 'px';">
                        </div>
                        <div class="card-footer fade-out">
                            <p class="show_num">-/-</p>
                        </div>
                        <div class="card-footer fade-in none">
                            <div class="container two">
                                <div class="btn-2 woi red cancel">
                                    <a href="#" class="cancel">
                                        <p>Cancelar </p>
                                    </a>
                                </div>
                                <div class="btn-2 woi sig">
                                    <a href="#" class="sig">
                                        <p>Siguiente </p>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card v2 sqr" id="respiracion">
                        <div class="card-header fade-out">
                            <a class="add">
                                <i class="material-icons">add_circle</i>
                            </a>
                            <p>Respiración</p>
                        </div>
                        <div class="card-header fade-in none">
                            <img src="../static/icons/Respiración.svg" alt="">
                            <p class="title">Respiración</p>
                            <p class="edit">Editar</p>
                        </div>
                        <div class="card-content fade-out">
                            <img src="../static/icons/Respiración.svg" alt="">
                            <p>resp/min</p>
                        </div>
                        <div class="card-content fade-in none">
                            <p></p>
                            <input type="number" name="temp_num" id="resp_num" class="notnull"
                                onkeypress="this.style.width = ((this.value.length + 1) * 48) + 'px';">
                            <input type="text" name="unity" class="unity"
                                onkeypress="this.style.width = ((this.value.length + 1) * 24) + 'px';">
                        </div>
                        <div class="card-footer fade-out">
                            <p class="show_num">-</p>
                        </div>
                        <div class="card-footer fade-in none">
                            <div class="container two">
                                <div class="btn-2 woi red cancel">
                                    <a href="#" class="cancel">
                                        <p>Cancelar </p>
                                    </a>
                                </div>
                                <div class="btn-2 woi sig">
                                    <a href="#" class="sig">
                                        <p>Siguiente </p>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card v2 sqr" id="pulso">
                        <div class="card-header fade-out">
                            <a class="add">
                                <i class="material-icons">add_circle</i>
                            </a>
                            <p class="edit">Pulso</p>
                        </div>
                        <div class="card-header fade-in none">
                            <img src="../static/icons/Pulso.svg" alt="">
                            <p class="title">Pulso</p>
                            <p class="edit">Editar</p>
                        </div>
                        <div class="card-content fade-out">
                            <img src="../static/icons/Pulso.svg" alt="">
                            <p>ppm</p>
                        </div>
                        <div class="card-content fade-in none">
                            <p></p>
                            <input type="number" name="temp_num" id="puls_num" class="notnull"
                                onkeypress="this.style.width = ((this.value.length + 1) * 48) + 'px';">
                            <input type="text" name="unity" class="unity"
                                onkeypress="this.style.width = ((this.value.length + 1) * 24) + 'px';">
                        </div>
                        <div class="card-footer fade-out">
                            <p class="show_num">-</p>
                        </div>
                        <div class="card-footer fade-in none">
                            <div class="container two">
                                <div class="btn-2 woi red cancel">
                                    <a href="#" class="cancel">
                                        <p>Cancelar </p>
                                    </a>
                                </div>
                                <div class="btn-2 woi sig">
                                    <a href="#" class="sig">
                                        <p>Siguiente </p>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="slot medicamentos">
                <div class="title">
                    <p class="text">Medicamentos</p>
                </div>
                <div class="content">
                    <div class="cards">

                    </div>
                    <div class="item-input v2">
                        <a class="med">
                            <i class="material-icons">add_circle</i>
                            <p>Agregar medicamento</p>
                        </a>
                    </div>
                </div>
            </div>
            <div class="slot dates_pays">
                <div class="title">
                    <p class="text">Citas y Pagos</p>
                </div>
                <div class="content">
                    <div class="card v2 cita none">
                        <div class="rectangle turquoise"></div>
                        <div class="card-content">
                            <div class="head">
                                <i class="material-icons turquoise">today</i>
                                <a class="arrow popover-open" style="display: none;" data-popover=".popover-file">
                                    <i class="material-icons">more_horiz</i>
                                </a>
                            </div>
                            <div class="date_row">
                                <p class="title">Clinica</p>
                                <p class="date">13 / Mar / 2020</p>
                            </div>
                            <p class="name">William Aristeo Gonzalez</p>
                            <p class="phone">8449876543</p>
                            <p class="data">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod
                                tempor incididunt. </p>
                        </div>
                    </div>
                    <div class="item-input v2 cita">
                        <a class="cita">
                            <i class="material-icons">today</i>
                            <p>Próxima cita</p>
                        </a>
                    </div>
                    <div class="card v2 yellow pago none">
                        <div class="rectangle yellow"></div>
                        <div class="card-content">
                            <div class="head">
                                <i class="material-icons icon yellow">monetization_on</i>
                                <a class="arrow" style="display: none;">
                                    <i class="material-icons">more_horiz</i>
                                </a>
                            </div>
                            <div class="date_row">
                                <p>Consulta</p>
                                <p class="date">13 / Mar / 2020</p>
                            </div>
                            <p class="money">$600.00</p>
                            <p class="status paid">Pagado</p>
                        </div>
                    </div>
                    <div class="item-input v2 pago">
                        <a class="pago">
                            <i class="material-icons">monetization_on</i>
                            <p>Pago</p>
                        </a>
                    </div>
                </div>
            </div>
            <div>
                <div class="container bsc">
                    <div class="btn-2 woi">
                        <a href="">
                            <p>Aceptar </p>
                        </a>
                    </div>
                    <div class="fab fab-center-bottom color-red">
                        <a href="#">
                            <!-- <i class="icon f7-icons if-not-md">plus</i> -->
                            <i class="icon material-icons">add</i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <datalist id="pacientes">
        </datalist>

        <div class="popover popover-file">
            <div class="popover-inner">
                <div class="list">
                    <ul>
                        <li><a class="list-button item-link download" href="#">Descargar PDF</a></li>
                        <hr>
                        <li><a class="list-button item-link delete" href="#">Eliminar</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</template>
<script>
    import $$ from 'dom7';
    export default {
        on: {
            pageBeforeIn: function (e, page) {
                var self = this;
                var app = self.$app;
                var var1 = false,
                    var2 = false,
                    var3 = false,
                    var4 = false;
                var doctor = JSON.parse(sessionStorage.getItem('user'));
                app.request.get(app.data.url + '/pacientes?doctor.id=' + doctor.doctor.id,
                    function (e) {
                        var x = JSON.parse(e);
                        x.forEach(element => {
                            $$('datalist').append(
                                '<option value="' + element.nombre + '" data-id="' + element.id + '">'
                            );
                        });
                    }
                );
            },
            pageInit: function (e, page) {
                var self = this;
                var app = self.$app;
                var files = [],
                    medics = [],
                    pago, cita;
                var moment = require('moment');
                moment.locale('es');
                moment().format();
                var doctor = JSON.parse(sessionStorage.getItem('user'));

                disableButton();

                let prevPageMedics = page.pageFrom != undefined && page.pageFrom.el.id == 'paciente-med-form';
                if (localStorage.getItem('files')) {
                    app.data.store.getItem('files').then(function (val) {
                        files = val;
                        addFilesCards();
                    });
                }
                if (localStorage.getItem('medics')) {
                    medics = JSON.parse(localStorage.getItem('medics'));
                    if (prevPageMedics) {
                        refillMedics();
                    }
                    addMedsCards();
                } else if (prevPageMedics) {
                    refillMedics();
                    addMedsCards();
                }
                if (localStorage.getItem('cita')) {
                    let z = JSON.parse(localStorage.getItem('cita'));
                    let date = moment(z.fecha);
                    app.data.store.getItem('cita_cons_name').then(function (val) {
                        $$('.card.cita .date_row .title').text(val);
                    });
                    $$('.card.cita .date_row .data').text(date.format('DD / MMM / YYYY'));
                    $$('.card.cita .name').text(z.nombre);
                    $$('.card.cita .phone').text(z.telefono);
                    $$('.card.cita .data').text(z.correo);
                    $$('.card.cita').toggleClass("none");
                    $$('.item-input.cita').toggleClass("none");
                }
                if (localStorage.getItem('pago')) {
                    let z = JSON.parse(localStorage.getItem('pago'));
                    let date = moment();
                    $$('.card.pago .date_row .date').text(date.format('DD / MMM / YYYY'));
                    $$('.card.pago .status').text(z.estatus);
                    if (z.estatus == 'confirmado') {
                        $$('.card.pago .status').removeClass('unpaid');
                        $$('.card.pago .status').addClass('paid');
                    } else if (z.estatus == 'pendiente') {
                        $$('.card.pago .status').addClass('unpaid');
                        $$('.card.pago .status').removeClass('paid');
                    }
                    $$('.card.pago .money').text('$' + z.costo);
                    $$('.card.pago').toggleClass("none");
                    $$('.item-input.pago').toggleClass("none");
                }
                if (localStorage.getItem('consultaName')) {
                    $$('input#nombre').val(localStorage.getItem('consultaName'));
                }
                if (localStorage.getItem('consultaMotivo')) {
                    $$('textarea#motivo').val(localStorage.getItem('consultaMotivo'));
                }
                if (localStorage.getItem('consultaNotes')) {
                    $$('textarea#notes').val(localStorage.getItem('consultaNotes'));
                }
                if (localStorage.getItem('temp_num')) {
                    $$('input#temp_num').val(localStorage.getItem('temp_num'));
                    $$('input#temp_num').closest('.card.sqr').find('.show_num').text(localStorage.getItem('temp_num'));
                }
                if (localStorage.getItem('puls_num')) {
                    $$('input#puls_num').val(localStorage.getItem('puls_num'));
                    $$('input#puls_num').closest('.card.sqr').find('.show_num').text(localStorage.getItem('puls_num'));
                }
                if (localStorage.getItem('resp_num')) {
                    $$('input#resp_num').val(localStorage.getItem('resp_num'));
                    $$('input#resp_num').closest('.card.sqr').find('.show_num').text(localStorage.getItem('resp_num'));
                }
                if (localStorage.getItem('pres_num')) {
                    $$('input#pres_num').val(localStorage.getItem('pres_num'));
                    $$('input#pres_num').closest('.card.sqr').find('.show_num').text(localStorage.getItem('pres_num'));
                }

                $$('.card.sqr').click(function (e) {
                    if ($$(this).parent().find('.primary').length == 0) {
                        animateOut(this, 0);
                    } else if (!$$(this).hasClass('primary')) {
                        animateIn();
                        animateOut(this, 300);
                    } else if ($$(e.srcElement).parent().hasClass('cancel')) {
                        animateIn();
                    } else if ($$(e.srcElement).parent().hasClass('sig')) {
                        animateIn();
                        animateOut($$(this).next(), 300);
                    }
                });

                $$('#file').change(function (e) {
                    let file = this.files[0];
                    if (file.size <= 5000000) {
                        files.push(file);
                        addFilesCards();
                        app.data.store.setItem('files', files);
                        localStorage.setItem('files', files);
                    } else {
                        app.dialog.alert('El archivo excede el tamaño maximo');
                    }
                });

                $$('#nueva_consulta .notnull').on('input:notempty', function (e) {
                    var nonempty = $$('input#nombre, textarea#motivo').filter(function () {
                        return this.value != ''
                    });
                    if (nonempty.length == 2) {
                        enableButton();
                    }
                });

                $$('#nueva_consulta .btn_back').click(function (val) {
                    app.data.store.getItem('back_consulta').then(function (value) {
                        localStorage.clear();
                        if (value == 'schedule') {
                            app.methods.redirectTo('schedule');
                        } else if (value == 'paciente') {
                            app.methods.redirectTo('paciente-perfil');
                        }
                    });
                });

                $$('input#nombre').on('input:notempty', function (e) {
                    localStorage.setItem('consultaName', $$(this).val());
                    localStorage.setItem('patient_id', $$('#pacientes option[value="' + $$(this).val() + '"]').data('id'));
                });

                $$('textarea#motivo').on('input:notempty', function (e) {
                    localStorage.setItem('consultaMotivo', $$(this).val());
                });

                $$('textarea#notes').on('input:notempty', function (e) {
                    localStorage.setItem('consultaNotes', $$(this).val());
                });

                $$('.card.sqr .notnull').on('input:notempty', function (e) {
                    localStorage.setItem($$(this).attr('id'), $$(this).val());
                    $$(this).closest('.card.sqr').find('.show_num').text($$(this).val());
                });

                $$('.item-input .med').click(function (e) {
                    app.methods.redirectTo('paciente-medicamento-form');
                });

                $$('.item-input .cita').click(function (e) {
                    app.methods.redirectTo('agendar-cita');
                });

                $$('.item-input .pago').click(function (e) {
                    app.methods.redirectTo('doctor-agregar-pago');
                });

                function enableButton(params) {
                    $$('#nueva_consulta .bsc .btn-2 a').off('click');
                    $$('#nueva_consulta .bsc .btn-2 a').removeClass('grey');
                    $$('#nueva_consulta .bsc .btn-2 a').click(function (val) {
                        /* app.data.store.getItem('patient_id').then(function(pnt_id) { */
                        app.data.store.getItem('files').then(function (files) {
                            var pnt_id = localStorage.getItem('patient_id');
                            if (pnt_id != undefined) {
                                let paciente, nombre, motivo, notas, archivos = [],
                                    vitales, cita, pago, medics_ids = [];
                                archivos = files;
                                console.log(archivos);

                                nombre = localStorage.getItem('consultaName');
                                motivo = localStorage.getItem('consultaMotivo');
                                notas = localStorage.getItem('consultaNotes');
                                vitales = {
                                    "Temperatura": {
                                        "value": localStorage.getItem('temp_num')
                                    },
                                    "presion": {
                                        "value": localStorage.getItem('pres_num')
                                    },
                                    "Respiracion": {
                                        "value": localStorage.getItem('resp_num')
                                    },
                                    "pulso": {
                                        "value": localStorage.getItem('puls_num')
                                    },
                                    "paciente": pnt_id,
                                    "consulta": ""
                                };
                                cita = JSON.parse(localStorage.getItem('cita'));
                                pago = JSON.parse(localStorage.getItem('pago'));
                                medics.forEach(function (med) {
                                    med.paciente = pnt_id;
                                    app.preloader.show('blue');
                                    app.request.postJSON(app.data.url + '/medicamentos', med,
                                        function (el) {
                                            console.log(el);
                                            medics_ids.push(el.id);
                                        },
                                        function (el) {
                                            app.preloader.hide();
                                        });
                                });
                                app.request.postJSON(app.data.url + '/consultas', {
                                    "motivo": motivo,
                                    "notas": notas,
                                    "medicamentos": medics_ids,
                                    "paciente": pnt_id,
                                    "doctor": doctor.doctor.id
                                },
                                    function (el) {
                                        app.request.postJSON(app.data.url + '/citas', cita,
                                            function (e) {
                                                app.preloader.hide();
                                                localStorage.clear();
                                                app.data.store.clear();
                                                out();
                                            },
                                            function (e) {
                                                app.preloader.hide();
                                            });
                                        app.request.postJSON(app.data.url + '/pagos', {
                                            "costo": pago.costo,
                                            "metodo": pago.metodo,
                                            "estatus": "confirmado",
                                            "paciente": pnt_id,
                                            "doctor": doctor.doctor.id,
                                            "consulta": el.id
                                        },
                                            function (el) {
                                                app.preloader.hide();
                                                localStorage.clear();
                                                app.data.store.clear();
                                                out();
                                            },
                                            function (el) {
                                                app.preloader.hide();
                                            });
                                        app.request.postJSON(app.data.url + '/vitales', {
                                            "Temperatura": {
                                                "value": localStorage.getItem('temp_num')
                                            },
                                            "presion": {
                                                "value": localStorage.getItem('pres_num')
                                            },
                                            "Respiracion": {
                                                "value": localStorage.getItem('resp_num')
                                            },
                                            "pulso": {
                                                "value": localStorage.getItem('puls_num')
                                            },
                                            "paciente": pnt_id,
                                            "consulta": el.id

                                        },
                                            function (el) {
                                                app.preloader.hide();
                                                localStorage.clear();
                                                app.data.store.clear();
                                                out();
                                            },
                                            function (el) {
                                                app.preloader.hide();
                                            }
                                        );

                                        const data = new FormData();
                                        archivos.forEach(function (file) {
                                            data.append("files", file);
                                        });
                                        data.append("refId", el.id);
                                        data.append("ref", "consulta");
                                        data.append('source', 'users-permissions');
                                        data.append('field', 'archivos');
                                        app.request({
                                            url: app.data.url + '/upload',
                                            method: "POST",
                                            crossDomain: true,
                                            contentType: "multipart/form-data",
                                            data: data,
                                            success: function (e) {
                                                app.preloader.hide();
                                                localStorage.clear();
                                                app.data.store.clear();
                                                out();
                                            },
                                            error: function (e) {
                                                app.preloader.hide();
                                            }
                                        });
                                    },
                                    function (el) {
                                        app.preloader.hide();
                                    }
                                );
                            }

                        });
                    });
                }

                function out() {
                    app.methods.redirectTo('home');
                }

                function animateIn() {
                    $$('.card.sqr.primary').find('.fade-in').toggleClass('show');
                    /* setTimeout(function () { */
                    $$('.card.sqr.primary').find('.fade-in').toggleClass('none');
                    /* }, 50);
                    setTimeout(function () { */
                    $$('.card.sqr.primary').find('.fade-out').toggleClass('none');
                    /* }, 50);
                    setTimeout(function () { */
                    $$('.card.sqr.primary').toggleClass('primary');
                    /* }, 200); */
                }

                function animateOut(e, x) {
                    setTimeout(function () {
                        $$(e).toggleClass('primary');
                    }, 0 + x);
                    setTimeout(function () {
                        $$('.card.sqr.primary').find('.fade-out').toggleClass('none');
                    }, 250 + x);
                    setTimeout(function () {
                        $$('.card.sqr.primary').find('.fade-in').toggleClass('none');
                    }, 250 + x);
                    setTimeout(function () {
                        $$('.card.sqr.primary').find('.fade-in').toggleClass('show');
                    }, 500 + x);

                }

                function checkData(e) {
                    var nonempty = $$('#nueva_consulta .notnull').filter(function () {
                        return this.value != ''
                    });

                    if (nonemptyinput.length == 6) {

                    }
                }

                function refillMedics(e) {
                    medics.push(JSON.parse(localStorage.getItem('medicina')));
                    localStorage.setItem('medics', JSON.stringify(medics));
                }

                function addFilesCards() {
                    $$('.archivos .cards').empty();
                    files.forEach(el => {
                        let date = moment(el.lastModifiedDate);
                        $$('.archivos .cards').append(
                            '<div class="card v2">' +
                            '<div class="rectangle turquoise"></div>' +
                            '<div class="card-content">' +
                            '<i class="material-icons clip">attach_file</i>' +
                            '<div class="data">' +
                            '<p class="text nomxhe">' + el.name + '</p>' +
                            '<p class="title grey">' + date.format('DD/MM/YYYY') + '</p>' +
                            '</div>' +
                            '<a class="arrow popover-open" data-popover=".popover-file">' +
                            '<i class="material-icons">more_horiz</i>' +
                            '</a>' +
                            '</div>' +
                            '</div>'
                        );
                    });
                }

                function addMedsCards() {
                    $$('.medicamentos .cards').empty();

                    medics.forEach(el => {
                        $$('.medicamentos .cards').append(
                            '<div class="card v2 light-blue">' +
                            '<div class="rectangle light-blue"></div>' +
                            '<div class="card-content">' +
                            '<img src="../static/icons/Medicinas.svg">' +
                            '<div class="data">' +
                            '<p class="text">' + el.nombre + '</p>' +
                            '<p class="title grey">' + el.tipo_medicina + ' - ' + el.tipo_ingesta + '</p>' +
                            '</div>' +
                            '<a class="arrow">' +
                            '<i class="material-icons">chevron_right</i>' +
                            '</a>' +
                            '</div>' +
                            '</div>'
                        );


                    });
                }


                function disableButton() {
                    $$('#nueva_consulta .bsc .btn-2 a').addClass('grey');
                    $$('#nueva_consulta .bsc .btn-2 a').off('click');
                }
            }
        }
    }
</script>