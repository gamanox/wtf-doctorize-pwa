<template>
    <div class="page" id="doctor-agregar-pago-summary">
        <div class="header">
            <div class="addPay info">
                <a class="back">
                    <i class="material-icons">chevron_left</i>
                </a>
                <p class="title1">Resumen de pago</p>
            </div>
        </div>
        <div class="page-content">
            <div class="breakdown">
                <div class="title">
                    Desglose de pago:
                </div>
                <div class="name">
                    <p class="label">Nombre</p>
                    <p class="data dark-blue">Laura Rodr√≠guez</p>
                </div>
                <div class="concept">
                    <p class="label">Concepto</p>
                    <p class="data dark-blue">Consulta</p>
                </div>
                <div class="method">
                    <p class="label">Metodo de pago</p>
                    <p class="data dark-blue" style="text-align: right;">Efectivo</p>
                </div>
                <div class="total">
                    <p class="label">Total</p>
                    <p class="data dark-blue">$600.00</p>
                </div>
            </div>
            <div class="container">
                <div class="btn-2">
                    <a href="#">
                        <p>Agregar </p>
                    </a>
                </div>
            </div>
        </div>
    </div>
</template>
<script>
    import $$ from 'dom7';

    export default {
        on: {
            pageInit: function(e, page) {
                var self = this;
                var app = self.$app;
                var nombre, pacienteId, metodo, total, consulta;
                var doctor = JSON.parse(sessionStorage.getItem('user'));
                app.data.store.iterate(function(value, key, i) {
                    switch (key) {
                        case "pago-patient":
                            nombre = value;
                            break;
                        case "pago-patient-id":
                            pacienteId = value;
                            break;
                        case "metodo":
                            metodo = value;
                            break;
                        case "costo":
                            total = value;
                            break;
                        case "pado-pend-id":
                            consulta = value;
                            break;
                        default:
                            break;
                    }

                }).then(function(e) {
                    $$('#doctor-agregar-pago-summary .name .data').text(nombre);
                    $$('#doctor-agregar-pago-summary .method .data').text(metodo);
                    $$('#doctor-agregar-pago-summary .total .data').text('$' + total);
                    $$('.container .btn-2 a').click(function(e) {
                        app.preloader.show('blue');
                        app.request.postJSON(app.data.url + '/pagos', {
                                "costo": total,
                                "metodo": metodo,
                                "estatus": "confirmado",
                                "paciente": pacienteId,
                                "doctor": doctor.doctor.id,
                                "consulta": consulta
                            },
                            function(el) {
                                app.preloader.hide();
                                app.methods.redirectTo('doctor-agregar-pago-success');
                            },
                            function(el) {
                                app.dialog.alert("Error al registrar pago");
                                app.preloader.hide();
                            });

                        /* 
                        let consulta = localStorage.getItem('consulta');
                        if (consulta) {
                            let newMed = {
                                "pago": "pago"
                            };
                            localStorage.setItem('pago', JSON.stringify(newMed));
                            app.methods.redirectTo('nueva-consulta');
                        } else { */

                        /* } */
                    });
                });
            }
        }
    }
</script>