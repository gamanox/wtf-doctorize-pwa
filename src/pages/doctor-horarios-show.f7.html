<template>
    <div class="page" data-name="doctor-horarios-show" id="doctor-horarios-show">
        <div class="page-content">
            <div class="header">
                <div class="doc-horarios-add show">
                    <a class="close" href="#">
                        <i class="material-icons">chevron_left</i>
                    </a>
                    <p class="title1">Horarios name</p>
                    <a class="edit" href="#">
                        <i class="material-icons">more_horiz</i>
                    </a>
                </div>
            </div>
            <div class="list" id="info">
                <ul>
                    <li>
                        <div class="card card-outline doc-horarios add" id="asist">
                            <div class="rectangle light-blue"></div>
                            <i class="clock material-icons light-blue">
                                person
                            </i>
                            <div class="card-content card-content-padding">
                                <p class="light-blue">Karla Campos</p>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="card card-outline doc-horarios add" id="hosp">
                            <div class="rectangle red"></div>
                            <i class="clock material-icons red">
                                room
                            </i>
                            <div class="card-content card-content-padding ">
                                <p class="red">Hospital La Conchita</p>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="list" id="cards">
                <ul>
                    <li id="lunes">
                        <div class="card card-outline doc-horarios days show">
                            <div class="rectangle turquoise"></div>
                            <div class="card-header ">
                                Lunes
                            </div>
                            <div class="card-content card-content-padding">
                                <label class="toggle toggle-init color-black">
                                    <input type="checkbox" checked>
                                    <span class="toggle-icon"></span>
                                </label>
                                <div class="resume">
                                    <p id="1">08:00 - 13:00</p>
                                    <hr>
                                    <p id="2">15:00 - 21:00</p>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li id="martes">
                        <div class="card card-outline doc-horarios days show">
                            <div class="rectangle turquoise"></div>
                            <div class="card-header ">
                                Martes
                            </div>
                            <div class="card-content card-content-padding">
                                <label class="toggle toggle-init color-black">
                                    <input type="checkbox" checked>
                                    <span class="toggle-icon"></span>
                                </label>
                                <div class="resume">
                                    <p id="1">08:00 - 13:00</p>
                                    <hr>
                                    <p id="2">15:00 - 21:00</p>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li id="miercoles">
                        <div class="card card-outline doc-horarios days show">
                            <div class="rectangle turquoise"></div>
                            <div class="card-header ">
                                Miercoles
                            </div>
                            <div class="card-content card-content-padding">
                                <label class="toggle toggle-init color-black">
                                    <input type="checkbox" checked>
                                    <span class="toggle-icon"></span>
                                </label>
                                <div class="resume">
                                    <p id="1">08:00 - 13:00</p>
                                    <hr>
                                    <p id="2">15:00 - 21:00</p>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li id="jueves">
                        <div class="card card-outline doc-horarios days show">
                            <div class="rectangle turquoise"></div>
                            <div class="card-header ">
                                Jueves
                            </div>
                            <div class="card-content card-content-padding">
                                <label class="toggle toggle-init color-black">
                                    <input type="checkbox" checked>
                                    <span class="toggle-icon"></span>
                                </label>
                                <div class="resume">
                                    <p id="1">08:00 - 13:00</p>
                                    <hr>
                                    <p id="2">15:00 - 21:00</p>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li id="viernes">
                        <div class="card card-outline doc-horarios days show">
                            <div class="rectangle turquoise"></div>
                            <div class="card-header ">
                                Viernes
                            </div>
                            <div class="card-content card-content-padding">
                                <label class="toggle toggle-init color-black">
                                    <input type="checkbox" checked>
                                    <span class="toggle-icon"></span>
                                </label>
                                <div class="resume">
                                    <p id="1">08:00 - 13:00</p>
                                    <hr>
                                    <p id="2">15:00 - 21:00</p>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li id="sabado">
                        <div class="card card-outline doc-horarios days show">
                            <div class="rectangle turquoise"></div>
                            <div class="card-header ">
                                Sabado
                            </div>
                            <div class="card-content card-content-padding">
                                <label class="toggle toggle-init color-black">
                                    <input type="checkbox" checked>
                                    <span class="toggle-icon"></span>
                                </label>
                                <div class="resume">
                                    <p id="1">08:00 - 13:00</p>
                                    <hr>
                                    <p id="2">15:00 - 21:00</p>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li id="domingo">
                        <div class="card card-outline doc-horarios days show">
                            <div class="rectangle turquoise"></div>
                            <div class="card-header ">
                                Domingo
                            </div>
                            <div class="card-content card-content-padding">
                                <label class="toggle toggle-init color-black">
                                    <input type="checkbox" checked>
                                    <span class="toggle-icon"></span>
                                </label>
                                <div class="resume">
                                    <p id="1">08:00 - 13:00</p>
                                    <hr>
                                    <p id="2">15:00 - 21:00</p>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</template>
<script>
    import $$ from 'dom7';
    export default {
        on: {
            pageInit: function(e, page) {
                var self = this;
                var app = self.$app;
                var asistente, horario, nombre, hospital;
                //llenar datos ***************

                app.data.store.iterate(function(value, key, i) {
                    switch (key) {
                        case "asist-json":
                            asistente = value;
                            break;
                        case "horario-name":
                            nombre = value;
                            break;
                        case "hosp-json":
                            hospital = value;
                            break;
                        case "horario-json":
                            horario = value;
                            break;
                        default:
                            break;
                    }

                }).then(function(e) {
                    $$('#doctor-horarios-show .title1').text(nombre);
                    $$('#info #asist .card-content p').text(asistente);
                    $$('#info #hosp .card-content p').text(hospital);
                    horario.forEach(x => {
                        fillEdit(x);
                    });
                });

                $$('.header .edit').click(function(x) {
                    //variable de edicion, y redirije
                    app.data.store.setItem('show', true);
                    app.data.store.setItem('edit', true).then(function(value) {
                        app.methods.redirectTo('doctor-horarios-add');
                    });
                });

                //cuando un valor de un toggle cambie
                $$('.toggle').change(function(val) {
                    var toggle = app.toggle.get($$(this));
                    //toogle on/off
                    if (!toggle.checked) {
                        $$(this).closest('.card').addClass('inactive');
                        //desactivar horario*****************
                    } else {
                        $$(this).closest('.card').removeClass('inactive');
                        //activar horario**********************+
                    }

                });

                $$('.header .close').click(function(val) {
                    app.data.store.clear().then(function(x) {
                        app.methods.redirectTo('doctor-horarios');
                    });
                });

                function fillEdit(val) {
                    var toggle = app.toggle.get($$('#' + val.nombre + ' .card-content .toggle'));
                    if (val.activo) {
                        toggle.checked = true;
                        $$('#' + val.nombre + ' .card').closest('.card').removeClass('inactive');
                    } else {
                        toggle.checked = false;
                        $$('#' + val.nombre + ' .card').closest('.card').addClass('inactive');
                    }
                    $$('#' + val.nombre + ' .resume').empty();
                    for (let i = 0; i < val.horas.length; i++) {
                        const y = val.horas[i];
                        let ArrST = y.start.split(":");
                        let ArrEt = y.end.split(":");
                        let st = ArrST[0] + ':' + ArrST[1];
                        let et = ArrEt[0] + ':' + ArrEt[1];

                        if (i != 0) {
                            $$('#' + val.nombre + ' .resume').append('<hr>');
                        }
                        $$('#' + val.nombre + ' .resume').append('<p id="r' + y.id + '"> ' + st + ' - ' + et + '</p>');
                    }
                }

            }
        }
    }
</script>